generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id             String   @id @default(uuid())
  name           String
  email          String?
  createdAt      DateTime @default(now())
  billingAddress Json?
  phone          String?
  primaryContact Json?
  orders         Order[]

  @@map("customers")
}

model Order {
  id            Int         @id @default(autoincrement())
  customerId    String
  status        OrderStatus @default(DRAFT)
  notes         String?
  routeGeometry Json?
  createdAt     DateTime    @default(now())
  commodity     String?
  equipmentType String?
  flags         Json?
  miles         Float?
  reference     String?
  weightLbs     Float?
  rate          Float?      // Rate in dollars
  customer      Customer    @relation(fields: [customerId], references: [id], onDelete: Cascade)
  stops         Stop[]

  @@map("orders")
}

model Stop {
  id          String    @id @default(uuid())
  orderId     Int
  sequence    Int
  latitude    Float
  longitude   Float
  plannedTime DateTime?
  address     String
  city        String?
  state       String?
  stopType    StopType  @default(PICKUP)
  order       Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@unique([orderId, sequence])
  @@index([orderId])
  @@map("stops")
}

enum OrderStatus {
  DRAFT
  QUOTED
  CONFIRMED
}

enum StopType {
  PICKUP
  DELIVERY
}
